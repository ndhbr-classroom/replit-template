#!/bin/bash
workspace_path=`dirname $(dirname $(realpath $0))`
orga_url=git@github.com:ndhbr-classroom/

# loading
showLoading() {
    pid=$!
    loadingText="Downloading"

    echo -ne "$loadingText\r"

    while kill -0 $pid 2>/dev/null; do
    echo -ne "$loadingText.\r"
    sleep 0.25
    echo -ne "$loadingText..\r"
    sleep 0.25
    echo -ne "$loadingText...\r"
    sleep 0.25
    echo -ne "\r\033[K"
    echo -ne "$loadingText\r"
    sleep 0.25
    done

    printf "$loadingText finished.\n"
}

# git clone
cloneRepository() {
    git clone $orga_url$1.git --quiet
}

# check for parameter
if [ -z "$1" ]
then
    printf "Usage: get <REPOSITORY-NAME>\n"
else
    printf "Selected exercise: $1\n"

    # clone
    cd $workspace_path

    cloneRepository $1 & showLoading

    # git clone went wrong, probably enough error message by github
    if [ ! -d "$workspace_path/$1" ]; then
        exit 1
    fi

    # end result
    printf "\nYour exercise template was cloned into the folder $1. "
    printf "If you want to reset your task, just delete the folder $1 and run the command again.\n"
fi
